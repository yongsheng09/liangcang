<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>支付.良仓－生活美学指南</title>
        <meta name="keywords" content="良仓，良品，导购，购物，团购，社交，圈子，达人，分享，生活，时尚，白领，明星，潮流，精品,野兽派，野兽派花店，果库，想去，风格网，LC风格网，周末画报，新视线，GQ, VOGUE, 芭莎，尚雯婕，iweekly, ELLE, 优家，Yoox, net a porter, farfech, the coner, LN-ccshopping,share,social,design,designer,product,object,良仓、i良仓、物品、生活家、设计、导购、恋物、创意、良品、分享、社交、电商、淘宝、新视线、设计品、设计师、原创设计、北欧、独立设计师、设计品牌、明星导购、达人、设计商店、在线商店、闪购、打折、折扣、礼物、关注、粉丝、推荐、喜欢圈子、日本、全球购、丹麦、海外购、瑞典、复古、家居、家具、质感、品质">
        <meta name="description" content="良仓是数百位意见领袖引领的生活美学分享社区,良仓商店和APP精选售卖来自全球最精美的生活产品及礼物，良仓杂志的报道最有趣味及品味的人和事。">
        <link rel="stylesheet" href="css/reset.css" />
        <link rel="stylesheet" href="css/base.css" />
        <link rel="stylesheet" href="css/checkout.css" />
    </head>
    <body>
                <div class="fix">
                    <header>
                        <div class="header-wrap">
                            <a href="index.html" class="logo"></a>
                            <ul class="menu">
                                <li><a href="login.html" class="gin change">登录</a></li>
                                <li><a href="register.html" class="gin register">注册</a></li>
                                <li class="line"></li>
                                <li><a href="#" class="space">购物车</a></li>
                                <li class="line"></li>
                                <li><a href="#" class="space">消息</a></li>
                                <li class="line"></li>
                                <li><a href="#" class="add">添加良品</a></li>
                            </ul>
                        </div>
                    </header>
                    <nav>
                        <ul id="nav">
                            <li class="home">
                                <a href="index.html">首页</a>
                            </li>
                            <li class="shop">
                                <a href="shop.html">商店</a>
                                <div class="shop-list">
                                    <div class="shop-list-wrap">
                                        <ul id="nav-twolist">
                                            <li><img src="images/jiaju.png" alt="" /><a href="javascript:;"></a></li>
                                            <li><img src="images/jiaju2.png" alt="" /><a href="javascript:;"></a></li>
                                            <li><img src="images/wenju.png" alt="" /><a href="javascript:;"></a></li>
                                            <li><img src="images/shuma.png" alt="" /><a href="javascript:;"></a></li>
                                            <li><img src="images/wanle.png" alt="" /><a href="javascript:;"></a></li>
                                            <li><img src="images/chuwei.png" alt="" /><a href="javascript:;"></a></li>
                                            <li><img src="images/meishi.png" alt="" /><a href="javascript:;"></a></li>
                                            <li><img src="images/nanzhuang.png" alt="" /><a href="javascript:;"></a></li>
                                            <li><img src="images/nvzhuang.png" alt="" /><a href="javascript:;"></a></li>
                                            <li><img src="images/tongzhuang.png" alt="" /><a href="javascript:;"></a></li>
                                            <li><img src="images/xiebao.png" alt="" /><a href="javascript:;">鞋包</a></li>
                                            <li><img src="images/peishi.png" alt="" /><a href="javascript:;">配饰</a></li>
                                            <li><img src="images/meihu.png" alt="" /><a href="javascript:;">美护</a></li>
                                            <li><img src="images/huwai.png" alt="" /><a href="javascript:;">户外</a></li>
                                            <li><img src="images/zhiwu.png" alt="" /><a href="javascript:;">植物</a></li>
                                            <li><img src="images/tushu.png" alt="" /><a href="javascript:;">图书</a></li>
                                            <li><img src="images/yishu.png" alt="" /><a href="javascript:;">艺术</a></li>
                                            <li><img src="images/liwu.png" alt="" /><a href="javascript:;">礼物</a></li>
                                            <li><img src="images/tuijian.png" alt="" /><a href="javascript:;">推荐</a></li>
                                        </ul>
                                        <div class="findAll">
                                            <span>查看所有品牌 ></span> <span>最新到货 ></span>
                                        </div>
                                    </div>
                                    <div class="magazine">
                                        <img src="images/newsee.jpg" alt="" />
                                        <p>新视线 ：<span>2015年7月刊</span></p>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <a href="#">杂志</a>
                            </li>
                            <li>
                                <a href="#">分享</a>
                            </li>
                            <li>
                                <a href="#">达人</a>
                            </li>

                        </ul>
                        <div class="search">
                            <input type="text" placeholder="search..." id="str" />
                            <a href="javascript:;" class="btn"></a>
                        </div>
                    </nav>
                </div>
                <section>
                    <div class="middle">
                        <div class="checkout-logo">
                            <img src="images/checkout-logo.jpg" alt="" />
                        </div>
                        <div class="list">
                            <span>购物车</span>
                            <span class="jiesuan">结算</span>
                        </div>
                        <div class="adress">收货地址</div>
                        <div class="newAddress">

                                <i class="btn-left"></i><i class="btn-right"></i>
                                <div class="address-list">
                                    <ul>

                                    </ul>
                                </div>
                                <div class="Add">
                                    <input type="checkbox" class="show" /><span><em>使用新地址</em><i></i></span>
                                </div>
                                <form action="" class="oForm">
                                    <p>
                                        <span>收货人姓名</span>
                                        <input type="text" name="consignee" />
                                    </p>

                                    <p>
                                        <span>省<i>/</i>市</span>
                                        <select name="province" class="select1">
                                            <option >所在省份</option>
                                            <option value="北京">北京</option>
                                            <option value="安徽">安徽</option>
                                            <option value="福建">福建</option>
                                        </select>
                                        <select name="city" class="select2">
                                            <option >所在市区</option>
                                            <option >通州区</option>
                                            <option >朝阳区</option>
                                            <option >大兴区</option>
                                        </select>
                                    </p>
                                    <p>
                                        <span>详细地址</span>
                                        <input type="text" name="address"  />
                                    </p>
                                    <p>
                                        <span>手机号码</span>
                                        <input type="text" name="mobile" />
                                    </p>
                                    <input type="button" value="保存地址" class="btn" />
                                </form>
                        </div>
                        <div class="order">
                            <span>订单详情</span>

                            <img src="images/totop.png" alt="" />
                        </div>
                        <div class="order-msg">
                            <ul>

                            </ul>
                        </div>
                        <div class="remarks">
                            备注:<input type="text" placeholder="您可在此写下订单备注，不得超过350字符" />
                        </div>
                        <div class="activa">
                            <div class="activ-left">
                                <span>激活代金券</span><input type="text" placeholder="请输入代金券" />
                                <input type="button" value="确认使用" /><a href="javascript:;">代金券使用方法</a>
                            </div>
                            <div class="activ-right">
                                代金券减免<span>-0.00元</span>
                            </div>
                        </div>
                        <div class="discount">
                            <p>满减活动减免 <span>-0.00元</span></p>
                            <p>付款总额<b>:</b><span class="total">0.00</span></p>
                            <p>￥000.00</p>
                        </div>
                        <div class="method">
                            <div class="title">
                               结算方式<span>为您节省<b>0.00元</b></span>
                            </div>
                            <span>(含¥0.00礼物包装费)</span>
                            <div class="select">
                                <input type="radio" checked/><img src="images/zfb_icon.png" alt="" />
                            </div>
                        </div>
                        <div class="call">
                            <p>若您遇到支付问题，请联系客服热线 400 897 6336（工作日 09:00-18:00）</p>
                            <input type="button" value="结算" id="lastBtn" />
                        </div>
                    </div>
                </section>
                <div class="foot">
                    <p><a href="#"><em></em></a><a href="#"><i></i></a></p>
                        <ul>
                            <li class="foot-li">
                                <em></em>
                                <div>
                                <h4>全球精品</h4>
                                <p>Global Selections</p>
                                </div>
                            </li>
                            <li class="foot-li foot-em2">
                                <em></em>
                                <div>
                                <h4>正品保证</h4>
                                <p>Authenticity</p>
                                </div>
                            </li>
                            <li class="foot-li foot-em3">
                                <em></em>
                                <div>
                                <h4>全场包邮</h4>
                                <p>Free Delivery</p>
                                </div>
                            </li>
                            <li class="foot-li foot-em4">
                                <em></em>
                                <div>
                                <h4>400-897-6336</h4>
                                <p>工作日 09:00-18:00</p>
                                </div>
                            </li>
                        </ul>
                </div>
                <footer>
                    <div class="empty1"></div>
                    <div class="bottom">
                        <div class="footer-top">
                            <div class="scan">
                                <i></i>
                                <div class="load">
                                    <p>iPhone Android</p>
                                    <span>客户端下载</span>
                                </div>
                                <div class="twolist">
                                    <div class="iphone">
                                        <div class="iphone-top">
                                            <i></i>
                                        </div>

                                        <p>下载iPhone版</p>
                                    </div>
                                    <div class="android">
                                        <div class="android-top">
                                            <i></i>
                                        </div>
                                        <p>下载Android版</p>
                                    </div>
                                    <div class="empty2"></div>
                                </div>
                            </div>
                            <div class="loginstyle">
                                   <div class="weixin">
                                       <div class="wrap-scan">
                                           <a href="#" class="weixinscan"></a>
                                       </div>
                                   </div>
                                <a href="#" class="weibo"></a>
                                <a href="#" class="douban"></a>
                            </div>
                        </div>
                        <ul class="friendlink">
                            <li><a href="#">关于良仓</a></li><li class="foot-line"></li><li><a href="#">服务协议</a></li><li class="foot-line"></li>
                            <li><a href="#">隐私保护政策</a></li><li class="foot-line"></li><li><a href="#">使用指南</a></li><li class="foot-line"></li>
                            <li><a href="#">联系我们</a></li><li class="foot-line"></li><li><a href="#">加入我们</a></li><li class="foot-line"></li>
                            <li><a href="#">友情链接</a></li><li class="foot-line"></li><li><a href="#">私信良仓</a></li>
                        </ul>
                        <div class="texts">
                            <p>© 2013-2015 北京良仓文化传播有限公司版权所有 京ICP备13010677号-1 京公网安备11010502025627</p>
                            <p>公司名称：北京良仓文化传播有限公司  电话：010-58263516</p>
                            <p>公司地址：北京朝阳区百子湾路32号6号楼1层60号.</p>
                            <p>社会信用统一代码：91110105059231575L  食品许可证：JY11105160159557</p>
                            <p>图书证名称：中华人民共和国出版物经营许可证  图书证编号：新出发京零 字第 朝 150051 号</p>
                        </div>
                    </div>
                </footer>
                <div class="totop"></div>
                <div class="cue">
                    <div class="cue-msg">
                        <div class="close"></div>
                        <img src="images/pop_bg_header.png" alt="" />
                        <p></p>
                    </div>
                </div>

                <script src="js/jQuery-v1.12.4.min.js"></script>
                <script src="js/base.js"></script>
            <script>
                var address_id = 0;
                if(localStorage.getItem("token")){
                     $(".change").html("欢迎您"+localStorage.getItem("username"));
                     $(".register").empty();
                 }
                //商品详情页跳转到此页面
                var goodid = localStorage.goodsid,
                    goodnum = localStorage.goodsnum,
                    goodprice = localStorage.goodsprice;
                $.ajax({
                    "url": "http://h6.duchengjiu.top/shop/api_goods.php",
                    "type": "GET",
                    "dataType": "json",
                    "data": {
                        goods_id: goodid
                    },
                    "success": function(msg){
                        var obj = msg.data[0];
                        $(".order-msg ul").append(`
                            <li>
                                <img src="${obj.goods_thumb}" alt="" />
                                <p>${obj.goods_name}</p>
                                <span>X${goodnum}</span>
                                <span>￥${goodprice}</span>
                            </li>
                        `)
                        $(".total").html("￥"+goodprice+"<span>.00</span>");
                        $("#lastBtn").click(function(){
                            if(address_id){
                                location.href = "pay.html?num="+goodprice;
                            }else{
                                $(".cue").show();
                                $(".cue p").html("请选择收货地址")
                            }


                        })
                    }
                })

                 /*点击关闭弹出框*/
                 $(".close").click(function(){$(".cue").hide()});
                 /*获取上页传过来的总金额*/
                 var str = location.search.substr(1);
                 var sum = str.split("=");
                 $(".total").html(sum[1])
                 /*查看用户收货地址列表*/
                addressAjax();
                function addressAjax(){
                    $.ajax({
                        "url": "http://h6.duchengjiu.top/shop/api_useraddress.php?token=" + localStorage.token,
                        "type": "GET",
                        "dataType": "json",
                        "success": function(response){
                            console.log(response);
                            for(var i=0;i<response.data.length;i++){
                                var obj = response.data[i];
                                $(".address-list ul").append(`
                                    <li class="${obj.address_id}">
                                        <p>
                                            <span class="user">${obj.consignee}</span>
                                            <span class="phone">${obj.mobile}</span>
                                        </p>
                                        <div>
                                            <span class="province">${obj.province}</span>
                                            <span class="city">${obj.city}</span>
                                            <p class="address">${obj.address}</p>
                                        </div>
                                        <span class="default">默认地址</span>
                                        <span class="modify">编辑</span>
                                        <span class="delete">删除</span>
                                    </li>
                                `);
                            }


                            $(".address-list ul li").bind({
                                mouseenter:function(){
                                    $(this).find(".default,.modify,.delete").show();
                                },
                                mouseleave:function(){
                                    $(this).find(".default,.modify,.delete").hide();
                                }
                            })

                            $(".address-list ul li").click(function(){
                                $(this).css("border-color","#7fa6c5").siblings().css("border-color","#ededed");
                                $(this).find(".default,.modify,.delete").show();
                                $(this).siblings().find(".default,.modify,.delete").hide();
                                $(this).unbind("mouseenter").unbind("mouseleave");
                                $(this).siblings().bind({
                                    mouseenter:function(){
                                        $(this).find(".default,.modify,.delete").show();
                                    },
                                    mouseleave:function(){
                                        $(this).find(".default,.modify,.delete").hide();
                                    }
                                });
                                address_id = $(this).attr("class");
                                console.log(address_id);
                            })


                            // //添加点击事件
                            // $(".address-item").click(function(event){
                            //     $(this).addClass("active").siblings().removeClass("active");

                            //     if(event.target){
                            //         address_id = event.target.getAttribute("data-id");
                            //      console.log(address_id);
                            //     }
                            // })

                            //删除地址
							$(".delete").click(function(){
								// console.log(this.parentNode);
                                if(confirm("确认删除选定的地址吗？删除后无法恢复。")){
                                    var addMsg = $(this).parent();
                                    addMsg.remove();
                                    deleteAddress(addMsg);
                                }

							})

                        }   //在成功里面
                    })
                }

                /*删除收货人地址ajax*/
                function deleteAddress(obj){
                    var address_id = $(obj).attr("class");
                    $.get("http://h6.duchengjiu.top/shop/api_useraddress.php?token="+localStorage.token+"&status=delete&address_id="+address_id,function(msg){
                            console.log(msg)
                    })
                }

                /*新增收货人地址*/
                $(".btn").click(function(){
                    var data = $(".oForm").serialize();
                    console.log(data);

                    if($("input[name='consignee']").val() === ""){
                        $(".cue").show();
                        $(".cue p").html("请输入真实姓名");
                        return;
                    }
                    if(($(".select1").val())=== "所在省份"){
                        $(".cue").show();
                        $(".cue p").html("请选择省份");
                        return;
                    }
                    if(($(".select2").val())=== "所在市区"){
                        $(".cue").show();
                        $(".cue p").html("请选择城市");
                        return;
                    }
                    if($("input[name='address']").val() === ""){
                        $(".cue").show();
                        $(".cue p").html("请填写详细地址");
                        return;
                    }
                    if($("input[name='mobile']").val() === ""){
                        $(".cue").show();
                        $(".cue p").html("请填写手机号码");
                        return;
                    }
                    if($("input[name='mobile']").val() === ""){
                        $(".cue").show();
                        $(".cue p").html("请填写手机号码");
                        return;
                    }
                    var reg = /^1[3-8]\d{9}$/;
                    if(!reg.test($("input[name='mobile']").val())){
                        $(".cue").show();
                        $(".cue p").html("请填写正确的手机号");
                        return;
                    }


                    $.ajax({
                        "url": "http://h6.duchengjiu.top/shop/api_useraddress.php?token=" + localStorage.token + "&status=add",
                        "type": "POST",
                        "dataType": "json",
                        "data": data,
                        "success": function(response){
                            if(response.code === 0){
                                console.log(response);
                                $(".oForm").css("display","none");
                                $(".show").removeAttr("checked");
                                $(".cue").show();
                                $(".cue p").html("添加地址成功！");
                            }
                        }

                    })
                });

//				$(".btn").click(function(){
//              var newStr=$("#str").val();
//              console.log(newStr);
//
//              window.location.href="detail.html?goods_id="+newStr
//          })


                //订单提交
                            // $("#lastBtn").click(function(){
                            //     // if( address_id === 0){
                            //     //     alert("请选择收货地址！");
                            //     //     return;
                            //     // }
                            //     //订单
                            //     if(address_id){
                            //         $.ajax({
                            //             "url": "http://h6.duchengjiu.top/shop/api_order.php?token="+localStorage.token+"&status=add",
                            //             "type": "POST",
                            //             "dataType": "json",
                            //             "data": {
                            //                 "address_id": address_id,  //地址id
                            //                 "total_prices": sum[1]     //购物车页面的总金额
                            //             },
                            //             "success": function(response){
                            //                 console.log(response);
                            //                 if(response.code === 0){
                            //                     location.href = "pay.html?sum="+sum[1];
                            //                 }
                            //             }

                            //         })
                            //     }else{
                            //         $(".cue").show();
                            //         $(".cue p").html("请选择收货地址")
                            //     }
                            //     })


               /* 新增地址显示与隐藏*/
                var run ;
                $(".order img").click(function(){
                    if(run){
                        $(this).css("transform","rotate(360deg)")
                        $(".order-msg").css("height","309");
                    }else{
                        $(this).css("transform","rotate(180deg)")
                        $(".order-msg").css("height","0");
                    }
                    run = !run;
                })

                /*订单详情显示与隐藏*/
                $(".show").click(function(){
                    if($(this).is(":checked")){
                        $(".Add i").css("transform","rotate(180deg)");
                        $(".oForm").css("display","block");
                    }else{
                        $(".Add i").css("transform","rotate(360deg)");
                        $(".oForm").css("display","none");
                    }
                })

                /*导入订单信息*???????????????????????*/
                // $.get("http://h6.duchengjiu.top/shop/api_cart.php?token="+localStorage.token,function(msg){
                //     // console.log(msg)
                //     if(msg.code===0){

                //         for(var i=0;i<msg.data.length;i++){
                //             var obj = msg.data[i];
                //             console.log(obj)
                //             $(".order-msg ul").append(`
                //                 <li>
                //                     <img src="${obj.goods_thumb}" alt="" />
                //                     <p>${obj.goods_name}</p>
                //                     <span>X${obj.goods_number}</span>
                //                     <span>￥${obj.goods_price}</span>
                //                 </li>
                //             `)
                //         }
                //     }
                // })


            </script>
    </body>
</html>